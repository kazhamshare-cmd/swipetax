# SwipeTax - スワイプで確定申告

## コンセプト

ANCHOKOのフラッシュカードUIを応用し、確定申告の経費仕分けを「スワイプ」で直感的に行えるサービス。

**タグライン**: 「スワイプするだけで確定申告」

## ターゲットユーザー

1. **副業サラリーマン** - 年末調整+副業収入の申告
2. **フリーランス** - 青色/白色申告
3. **個人事業主** - 事業所得の申告

## スワイプアクション

```
              ↑ 上スワイプ
              │ 保留（後で確認）
              │ 税理士に相談したい
              │
    ←─────────┼─────────→
 左スワイプ   │   右スワイプ
 カテゴリ変更 │   AI判定OK
 （修正）     │   （承認）
              │
              ↓ 下スワイプ
              私的支出（除外）
              経費にしない
```

### 各アクションの詳細

| 方向 | アクション | UI表示 | 色 |
|------|-----------|--------|-----|
| → 右 | 承認 | チェックマーク | 緑 |
| ← 左 | 修正 | カテゴリ選択表示 | 青 |
| ↑ 上 | 保留 | クエスチョンマーク | 黄 |
| ↓ 下 | 除外 | バツマーク | 赤 |

## 処理フロー

```
┌─────────────────────────────────────────────────────────────┐
│                    1. オンボーディング                        │
├─────────────────────────────────────────────────────────────┤
│  ┌──────────────────┐    ┌──────────────────┐              │
│  │ アンケート方式    │ OR │ 前年申告書読込    │              │
│  │                  │    │ (撮影/PDF)       │              │
│  │ ・申告種別       │    │                  │              │
│  │ ・事業形態       │    │ AI-OCRで自動判定 │              │
│  │ ・青色/白色      │    │ ・申告種別       │              │
│  └──────────────────┘    │ ・事業情報       │              │
│                          │ ・前年データ     │              │
│                          └──────────────────┘              │
├─────────────────────────────────────────────────────────────┤
│                    2. データ取り込み                         │
├─────────────────────────────────────────────────────────────┤
│  ┌────────────┐ ┌────────────┐ ┌────────────┐              │
│  │ クレカ明細  │ │ 銀行明細   │ │ レシート   │              │
│  │ CSV/撮影   │ │ CSV/撮影   │ │ 撮影       │              │
│  └────────────┘ └────────────┘ └────────────┘              │
│                                                             │
│  ┌────────────┐ ┌────────────┐                             │
│  │ freee連携  │ │ MF連携     │ (将来対応)                  │
│  │ API        │ │ API        │                             │
│  └────────────┘ └────────────┘                             │
├─────────────────────────────────────────────────────────────┤
│                    3. スワイプ仕分け                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│         ┌───────────────────────┐                          │
│         │    ¥12,800            │                          │
│         │    Amazon.co.jp       │                          │
│         │    2024/03/15         │                          │
│         │                       │                          │
│         │    AI判定: 消耗品費    │                          │
│         │    信頼度: 85%        │                          │
│         │                       │                          │
│         │    類似取引: 3件      │                          │
│         └───────────────────────┘                          │
│                                                             │
│    ← 左        ↑ 上                  右 →                  │
│   修正         保留                  OK                     │
│                ↓ 下                                         │
│                除外                                         │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                    4. 保留項目の処理                         │
├─────────────────────────────────────────────────────────────┤
│  ・上スワイプした項目を一覧表示                              │
│  ・税理士相談用のメモ追加機能                                │
│  ・再度スワイプで最終判断                                    │
├─────────────────────────────────────────────────────────────┤
│                    5. 申告書作成                             │
├─────────────────────────────────────────────────────────────┤
│  ┌────────────────────────────────────────┐                │
│  │ 追加情報入力                           │                │
│  │ ・家族構成（扶養控除）                 │                │
│  │ ・医療費（医療費控除）                 │                │
│  │ ・保険料（社会保険料控除）             │                │
│  │ ・住宅ローン（住宅ローン控除）         │                │
│  │ ・ふるさと納税（寄附金控除）           │                │
│  └────────────────────────────────────────┘                │
│                      ↓                                      │
│  ┌────────────────────────────────────────┐                │
│  │ 自動計算                               │                │
│  │ ・所得金額                             │                │
│  │ ・所得控除                             │                │
│  │ ・税額                                 │                │
│  │ ・還付/納付額                          │                │
│  └────────────────────────────────────────┘                │
├─────────────────────────────────────────────────────────────┤
│                    6. 出力・提出                             │
├─────────────────────────────────────────────────────────────┤
│  ┌────────────┐ ┌────────────┐ ┌────────────┐              │
│  │ PDF出力    │ │ e-Tax XML  │ │ 印刷       │              │
│  │ 確認用     │ │ 電子申告用 │ │ 郵送用     │              │
│  └────────────┘ └────────────┘ └────────────┘              │
└─────────────────────────────────────────────────────────────┘
```

## 対応申告書

### Phase 1 (MVP)
- 確定申告書B
- 白色申告

### Phase 2
- 青色申告決算書（一般用）
- 収支内訳書

### Phase 3
- 青色申告決算書（不動産所得用）
- 消費税申告書

## 経費カテゴリ（勘定科目）

```
┌─────────────────────────────────────────────┐
│               経費カテゴリ                   │
├─────────────────────────────────────────────┤
│ 旅費交通費    │ 電車、タクシー、飛行機      │
│ 通信費        │ 携帯、インターネット        │
│ 接待交際費    │ 会食、贈答品                │
│ 消耗品費      │ 文具、備品（10万円未満）    │
│ 新聞図書費    │ 書籍、雑誌、新聞            │
│ 広告宣伝費    │ 広告、宣伝                  │
│ 外注費        │ 業務委託、外注              │
│ 地代家賃      │ 事務所家賃（按分）          │
│ 水道光熱費    │ 電気、ガス、水道（按分）    │
│ 支払手数料    │ 振込手数料、決済手数料      │
│ 雑費          │ その他                      │
└─────────────────────────────────────────────┘
```

## AI経費判定ロジック

```typescript
interface Transaction {
  date: string;
  amount: number;
  merchant: string;
  description?: string;
  category?: string;
}

interface AIJudgment {
  category: string;       // 判定カテゴリ
  confidence: number;     // 信頼度 0-100
  reasoning: string;      // 判定理由
  similarTransactions: number; // 類似取引数
  isBusinessLikely: boolean;   // 事業経費の可能性
}

// 判定に使用する情報
// 1. 取引先名（merchant）のパターンマッチング
// 2. 金額の傾向
// 3. 過去の同一ユーザーの判断履歴
// 4. 一般的な経費パターン（学習データ）
// 5. ユーザーの事業種別
```

## ビジネスモデル

```
┌─────────────────────────────────────────────┐
│              料金プラン                      │
├─────────────────────────────────────────────┤
│                                             │
│  【PCブラウザ版】 無料                       │
│  ・全機能利用可能                           │
│  ・広告表示あり                             │
│                                             │
│  【スマホアプリ版】 サブスクリプション       │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ ベーシック: ¥980/月 または ¥4,800/年 │   │
│  │ ・取引仕分け無制限                   │   │
│  │ ・AI判定                            │   │
│  │ ・PDF出力                           │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  ┌─────────────────────────────────────┐   │
│  │ プロ: ¥1,980/月 または ¥9,800/年    │   │
│  │ ・ベーシック全機能                  │   │
│  │ ・e-Tax連携                         │   │
│  │ ・レシートOCR無制限                 │   │
│  │ ・クラウドバックアップ              │   │
│  │ ・税理士相談チャット                │   │
│  └─────────────────────────────────────┘   │
│                                             │
│  【申告時のみ課金】（代替案）                │
│  ・1申告あたり ¥2,980                       │
│  ・試用は無料、提出時に課金                 │
│                                             │
└─────────────────────────────────────────────┘
```

## 技術スタック

### ANCHOKOから再利用

| コンポーネント | ファイル | 用途 |
|---------------|---------|------|
| スワイプUI | `StudyClient.tsx` | framer-motionベースのスワイプ |
| Firebase認証 | `lib/auth.ts` | Google/Email認証 |
| Firestore | `lib/firebase.ts` | データベース |
| サブスク | `lib/subscription.ts` | RevenueCat連携 |
| i18n | `messages/*.json` | 多言語対応 |
| Capacitor設定 | `capacitor.config.ts` | iOS/Android対応 |
| Header/UserMenu | `components/` | 共通UI |

### 新規開発

| 機能 | 技術 | 備考 |
|------|------|------|
| AI経費判定 | OpenAI GPT-4 API | カテゴリ判定 |
| OCR | Google Cloud Vision API | レシート/明細読み取り |
| PDF生成 | pdf-lib / jsPDF | 申告書PDF出力 |
| 税計算 | 独自実装 | 所得税計算ロジック |
| e-Tax連携 | XML生成 | 国税庁フォーマット |

## データモデル

```typescript
// ユーザー情報
interface TaxUser {
  id: string;
  email: string;
  name: string;
  businessType: 'employee_side' | 'freelance' | 'sole_proprietor';
  filingType: 'white' | 'blue_simple' | 'blue_regular';
  fiscalYear: number;

  // 基本情報
  address?: string;
  birthDate?: string;
  myNumber?: string; // 暗号化保存

  // 事業情報
  businessName?: string;
  businessCategory?: string;
  businessStartDate?: string;
}

// 取引データ
interface Transaction {
  id: string;
  userId: string;
  fiscalYear: number;

  // 取引情報
  date: string;
  amount: number;
  merchant: string;
  description?: string;

  // 仕分け結果
  status: 'pending' | 'approved' | 'modified' | 'held' | 'excluded';
  category?: string;

  // AI判定
  aiCategory?: string;
  aiConfidence?: number;
  aiReasoning?: string;

  // メタデータ
  source: 'csv' | 'ocr' | 'manual' | 'api';
  sourceFile?: string;
  receiptImage?: string;

  createdAt: number;
  updatedAt: number;
}

// 控除情報
interface Deduction {
  id: string;
  userId: string;
  fiscalYear: number;

  type: 'medical' | 'social_insurance' | 'life_insurance' |
        'earthquake_insurance' | 'donation' | 'mortgage' |
        'spouse' | 'dependent' | 'basic';

  amount: number;
  details?: Record<string, unknown>;
}

// 申告書データ
interface TaxReturn {
  id: string;
  userId: string;
  fiscalYear: number;

  // 収入
  businessIncome: number;
  salaryIncome?: number;
  otherIncome?: number;

  // 経費
  expenses: Record<string, number>; // カテゴリ別
  totalExpenses: number;

  // 所得
  totalIncome: number;

  // 控除
  deductions: Record<string, number>;
  totalDeductions: number;

  // 税額
  taxableIncome: number;
  incomeTax: number;
  specialReconstructionTax: number;
  totalTax: number;

  // 納付/還付
  withholdingTax: number;
  prepaidTax: number;
  finalTax: number; // 正: 納付、負: 還付

  status: 'draft' | 'completed' | 'submitted';
  submittedAt?: number;

  createdAt: number;
  updatedAt: number;
}
```

## 画面構成

```
/                       - ランディングページ
/auth/login             - ログイン
/auth/signup            - 新規登録

/onboarding             - オンボーディング
/onboarding/survey      - アンケート方式
/onboarding/import      - 前年申告書読込

/import                 - データ取り込み
/import/csv             - CSV読込（クレカ/銀行明細）
/import/receipt         - レシート撮影（OCR）
/import/screenshot      - スクショ取込（QR決済対応）
/import/statement       - 明細撮影

/swipe                  - スワイプ仕分け（メイン）
/swipe/held             - 保留項目一覧

/deductions             - 控除入力
/deductions/medical     - 医療費
/deductions/insurance   - 保険料
/deductions/donation    - 寄附金
/deductions/family      - 扶養

/summary                - 集計・確認
/output                 - 出力（PDF/e-Tax）

/settings               - 設定
/subscription           - サブスクリプション
```

## MVP実装計画

### Phase 1: コア機能 (2週間)
1. プロジェクト初期化（ANCHOKOベース）
2. 認証システム（Firebase Auth）
3. スワイプUIの適用（経費カード用に修正）
4. 基本的なデータモデル実装
5. CSVインポート機能

### Phase 2: AI判定 (1週間)
1. OpenAI API連携
2. 経費カテゴリ判定ロジック
3. 信頼度スコア表示

### Phase 3: 申告書生成 (2週間)
1. 税額計算ロジック
2. 控除入力フォーム
3. PDF生成
4. 確定申告書Bフォーマット

### Phase 4: 仕上げ (1週間)
1. UI/UXブラッシュアップ
2. エラーハンドリング
3. テスト
4. デプロイ

## 法的考慮事項

1. **税理士法**:
   - 個別の税務相談はNG
   - 計算ツールとしての提供はOK
   - 「税務アドバイスではない」旨の免責表示必要

2. **個人情報保護**:
   - マイナンバーの取り扱いに注意
   - 暗号化保存必須
   - 利用目的の明示

3. **電子帳簿保存法**:
   - レシート画像の保存要件
   - タイムスタンプ要件の確認

## 競合サービス詳細分析

### Taxnap（タックスナップ）- 主要競合

| 項目 | 内容 |
|------|------|
| **価格** | ベーシック: ¥12,936/年、プレミアム: ¥28,776/年 |
| **特徴** | スマホ完結、丸投げ仕分け、スクショ取込 |
| **強み** | QR決済スクショ対応、AIによる自動仕分け |
| **弱み** | PC非対応、金融機関連携が限定的 |

#### Taxnapの主要機能（参考実装）

1. **スクショ仕分け機能**
   - PayPayなどQR決済のスクショから取引を読み取り
   - 一度に20枚まで一括アップロード
   - 電子帳簿保存法対応（スキャナ保存）

2. **丸投げ仕分け（プレミアム）**
   - 税理士監修AIによる自動仕分け
   - 1000枚の領収書を10秒で処理

3. **対応している入力方法**
   - 手動入力
   - カメラ/OCR（レシート撮影）
   - スワイプ仕分け
   - スクショ取り込み（QR決済）

### 他の競合

| サービス | 特徴 | 価格 | PC対応 |
|---------|------|------|--------|
| freee | 高機能、複式簿記対応 | ¥1,180〜/月 | ◯ |
| Money Forward | 銀行連携豊富 | ¥980〜/月 | ◯ |
| やよい | 老舗、サポート充実 | ¥9,680〜/年 | ◯ |
| Taxnap | スマホ特化 | ¥12,936〜/年 | ✕ |

### SwipeTaxの差別化ポイント

1. **PC完全無料** - freee/MFからの乗り換え促進
2. **Taxnapの弱点克服** - PC対応で作業効率UP
3. **圧倒的なUI/UX** - ANCHOKOベースの洗練されたスワイプUI
4. **低価格** - スマホアプリも競合より安く設定可能
5. **AI活用** - GPT-4による高精度カテゴリ判定

### 乗り換え訴求ポイント

```
「freee/Money Forward/やよいを使っている方へ」

・月額料金、払いすぎていませんか？
・SwipeTaxなら、PCブラウザ版は完全無料
・既存の会計ソフトからCSVエクスポート → SwipeTaxにインポートで簡単移行
・確定申告に必要な機能だけに絞ったシンプル設計
```

## 追加実装機能（Taxnap参考）

### QR決済スクショ取り込み機能

```
対応予定のQR決済:
- PayPay
- 楽天ペイ
- d払い
- au PAY
- LINE Pay
- メルペイ

処理フロー:
1. スクショをアップロード（最大20枚）
2. AI-OCRで取引情報を抽出
   - 日付
   - 金額
   - 取引先名
3. 自動でカテゴリ判定
4. スワイプで確認・修正
```

### 電子帳簿保存法対応

```
必要な対応:
- タイムスタンプ付与（NTA認定サービス連携）
- 検索機能（日付、金額、取引先）
- 解像度要件（200dpi以上）
- 訂正・削除履歴の保存
```

### 消費税申告対応（将来対応）

```
- インボイス登録番号管理
- 課税/非課税/免税の区分
- 簡易課税/本則課税の選択
- 消費税申告書の自動作成
```

---

## 開発進捗

### 完了済み
- [x] ANCHOKOからベースコードをコピー（2026/01/16）
- [x] npm install で依存関係インストール（2026/01/16）
- [x] Firebase設定（プレースホルダー）（2026/01/16）
- [x] スワイプUIコンポーネント実装 `/swipe` （2026/01/16）
  - `src/app/swipe/SwipeClient.tsx`
  - framer-motionベースの4方向スワイプ
  - カテゴリ選択モーダル
  - サンプルトランザクション表示

### 次のステップ

1. [ ] Firebaseコンソールで新プロジェクト作成・設定値を更新
2. [ ] オンボーディング画面実装
3. [ ] CSVパーサー実装（papaparse使用）
4. [ ] AI判定API実装（OpenAI GPT-4）
5. [ ] 税額計算ロジック実装
